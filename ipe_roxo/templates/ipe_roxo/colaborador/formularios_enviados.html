{% extends 'ipe_roxo/partials/base.html' %}
{% load static %}

{% block title %}Formulários Enviados{% endblock title %}

{% block content %}
{% include 'ipe_roxo/partials/navbar_colaborador.html' %}

<div class="container my-5">
  <h2 class="mb-4 text-center">Formulários Enviados</h2>

  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  {% if formularios %}
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Espécie</th>
            <th>Bairro</th>
            <th>Data de Envio</th>
            <th>Status</th>
            <th>Observação</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for f in formularios %}
            <tr>
              <td>{{ f.especie }}</td>
              <td>{{ f.bairro }}</td>
              <td>{{ f.data_envio|date:"d/m/Y" }}</td>
              <td>
                {% if f.status == 'pendente' %}
                  <span class="badge bg-warning text-dark">Pendente</span>
                {% elif f.status == 'aceito' %}
                  <span class="badge bg-success">Aceito</span>
                {% elif f.status == 'recusado' %}
                  <span class="badge bg-danger">Recusado</span>
                {% endif %}
              </td>
              <td>{{ f.observacao|default:"—" }}</td>
              <td>
                <a href="{% url 'detalhe_formulario' f.id %}" class="btn btn-info btn-sm">Ver</a>

                {% if f.status != 'aceito' %}
                  <a href="{% url 'editar_formulario' f.id %}" class="btn btn-warning btn-sm">Editar</a>
                {% endif %}

                <a href="{% url 'excluir_formulario' f.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja excluir?');">Excluir</a>

                {% if f.status != 'pendente' %}
                  <a href="{% url 'reenviar_formulario' f.id %}" class="btn btn-secondary btn-sm">Enviar p/ Admin</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info text-center">
      Nenhum formulário enviado ainda.
    </div>
  {% endif %}
</div>
{% endblock %}